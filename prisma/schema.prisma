generator client {
  provider = "prisma-client-js"
}

datasource db {
  // provider = "mongodb"
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// =============================================
// ENUMS definitions
enum Role {
  ADMIN
  USER
  SUPER_ADMIN
}

enum UNITS {
  ml
  mg
  g
  l
  unit
}

enum SIZE {
  ml
  g
  l
  mg
  unit
}

enum RESPONSE_STATUS {
  pending
  accepted
  rejected
}

// =============================================
// DATA TYPES
// type DrugName {
//   brand   String
//   generic String[]
// }

type ActiveIngredient {
  name     String
  strength Strength
}

type Strength {
  amount String
  per    String
}

// tk

type Quantity {
  batches Int?
  items   Int?
}

type Size {
  amount Int
  unit   SIZE
}

type Image {
  public_id  String
  width      Int
  height     Int
  url        String
  secure_url String
}

// type DrugImage {
//   cover String
//   inner String?
// }

type Price {
  item  Int
  batch Int
}

type Category {
  name        String
  description String
}

type AcitveIngredientType {
  activeIngredient ActiveIngredient
  strength         Strength
}

// =============================================
// MODELS
model User {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  firstName    String?
  lastName     String?
  username     String    @unique
  email        String?   @unique
  passwordHash String
  role         Role      @default(USER)
  sessions     Session[]
  // created requests
  requests     Request[] @relation(name: "userRequests")
  requestsIDs  String[]  @db.ObjectId

  // liked requests
  // likedRequests Request[] @relation(name: "LikedRequests", through: LikedRequest)
  likedRequests LikedRequest[]
  // likedRequests    Request[] @relation(fields: [likedRequestsIDs], references: [id])
  // likedRequestsIDs String[]  @db.ObjectId

  // liked drug items
  likedDrugItems LikedDrugItem[]
  // likedDrugItems DrugItem[] @relation(fields: [drugItemsIDs], references: [id])
  // drugItemsIDs   String[]   @db.ObjectId
}

model Request {
  id             String          @id @default(auto()) @map("_id") @db.ObjectId
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  brandName      String?
  genericName    String?
  strength       String?
  image          Image?
  responseStatus RESPONSE_STATUS @default(pending)
  response       String?
  likes          Int             @default(0)
  description    String?
  authorID       String          @db.ObjectId
  Author         User            @relation(name: "userRequests", fields: [authorID], references: [id], onDelete: Cascade)
  likedBy        LikedRequest[]
}

model LikedRequest {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  requestID String   @db.ObjectId
  userID    String   @db.ObjectId
  request   Request  @relation(fields: [requestID], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userID], references: [id], onDelete: Cascade)

  @@unique([userID, requestID])
}

model LikedDrugItem {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  drugItemID String   @db.ObjectId
  userID     String   @db.ObjectId
  drugItem   DrugItem @relation(fields: [drugItemID], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userID], references: [id], onDelete: Cascade)

  @@unique([userID, drugItemID])
}

model Session {
  // id        String   @id @default(auto()) @map("_id") @db.ObjectId
  id        String   @id @map("_id")
  userId    String   @db.ObjectId
  expiresAt DateTime
  user      User     @relation(references: [id], fields: [userId], onDelete: Cascade)
}

model Drug {
  id                String       @id @default(auto()) @map("_id") @db.ObjectId
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  brandName         String
  description       String?
  indications       String[]     @unique
  contraIndications String[]
  drugItems         DrugItem[]
  manufacturerID    String       @db.ObjectId
  manufacturer      Manufacturer @relation(fields: [manufacturerID], references: [id])
  categories        String[]
  notes             String[]
}

model DrugItem {
  id                   String              @id @default(auto()) @map("_id") @db.ObjectId
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  drug                 Drug                @relation(fields: [drugID], references: [id], onDelete: Cascade)
  drugID               String              @db.ObjectId
  activeIngredients    ActiveIngredient[]
  image                Image
  subImagesURL         String[]
  price                Price
  quantityInStock      Quantity?
  description          String?
  discount             Price?
  available            Boolean             @default(true)
  form                 String
  featured             Boolean             @default(false)
  dosageInstructions   DosageInstruction[] @relation(fields: [dosageInstructionIDs], references: [id])
  dosageInstructionIDs String[]            @db.ObjectId
  size                 Size
  itemsInBatch         Int?
  notes                String[]
  features             String[]
  likes                Int                 @default(0)
  likedBy              LikedDrugItem[]
  // likedBy              User[]              @relation(fields: [usersIDs], references: [id])
  // usersIDs             String[]            @db.ObjectId
}

model Manufacturer {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String   @unique
  country     String
  city        String
  drugs       Drug[]
  url         String?
  description String?
  featured    Boolean  @default(false)
}

model DosageInstruction {
  id              String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  minAge          Int
  maxAge          Int
  frequencyPerDay Int
  amountPerDose   Int
  unit            UNITS
  DrugItem        DrugItem[] @relation(fields: [drugItemIDs], references: [id])
  drugItemIDs     String[]   @db.ObjectId
}

model Info {
  id                String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  indications       String[]   @unique
  contraIndications String[]   @unique
  categories        Category[] @unique
  strengths         Strength[] @unique
  forms             String[]   @unique
  activeIngredients String[]
}

model Record {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  userID     String   @db.ObjectId
  drugItemID String   @db.ObjectId
  quantity   Quantity
}
